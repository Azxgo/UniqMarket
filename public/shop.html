<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UniqMarket</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="slider.css">
    <script src="login.js" defer></script>
    <script src="/js/script.js"></script>
    <script src="shared.js"></script>
</head>

<body>
    <header>
        <nav>
            <a href="./index.html"><img src="./img/logo.png" alt="logo" id="logo"></a>
            <div class="categorias">
                <button class="menu-button" onclick="toggleMenu()">
                    <span><img src="./img/icons/menu.png" alt="Menú"></span>
                    <span>Menu</span>
                </button>
                <div class="dropdown-menu" id="menu-dropdown">
                    <a href="./index.html">Inicio</a>
                    <a href="./shop.html">Tienda</a>
                </div>
            </div>
            <div class="container-searchbar">
                <form action="shop.html" method="get">
                    <input type="search" placeholder="Buscar productos" name="search" class="search-bar">
                    <button class="search-button" type="submit">
                        <img alt="Buscar" width="18" height="18" src="https://home.ripley.cl/rdex/navbarcomponent/search-icon.svg">
                    </button>
                </form>
            </div>
            <div class="login-buttons">
                <div class="user-info">
                    <a id="user-button" class="auth-button">Iniciar Sesión</a>
                    <div class="user-dropdown" id="user-dropdown">
                        <button id="edit-user">Editar Usuario</button>
                        <button id="delete-user">Eliminar Usuario</button>
                    </div>
                </div>
                <a href="register.html" id="register-button" class="auth-button">Registrarse</a>
                <a href="./cart.html" id="cart"><img src="./img/icons/shopping-cart2.png" alt="Carrito" id="imgCart"><span id="cart-count">0</span></a>
            </div>
        </nav>
    </header>
    <main>
        <section class="container">
            <div class="categories" style="margin: 0px;">
                <div class="item">
                    <button id="button-1" data-category-id="1">
                        <img src="./img/icons/accesorios.png">
                        <p>Accesorios</p>
                    </button>
                </div>
                <div class="item">
                    <button id="button-2" data-category-id="2">
                        <img src="./img/icons/alimentos.png">
                        <p>Alimentos</p>
                    </button>
                </div>
                <div class="item">
                    <button id="button-3" data-category-id="3">
                        <img src="./img/icons/coleccion.png">
                        <p>Colección</p>
                    </button>
                </div>
                <div class="item">
                    <button id="button-4" data-category-id="4">
                        <img src="./img/icons/hogar.png">
                        <p>Hogar</p>
                    </button>
                </div>
                <div class="item">
                    <button id="button-5" data-category-id="5">
                        <img src="./img/icons/literatura.png">
                        <p>Literatura</p>
                    </button>
                </div>
                <div class="item">
                    <button id="button-6" data-category-id="6">
                        <img src="./img/icons/mascotas.png">
                        <p>Mascotas</p>
                    </button>
                </div>
                <div class="item">
                    <button id="button-7" data-category-id="7">
                        <img src="./img/icons/miscelaneo.png">
                        <p>Misceláneo</p>
                    </button>
                </div>
                <div class="item">
                    <button id="button-8" data-category-id="8">
                        <img src="./img/icons/moda.png">
                        <p>Moda</p>
                    </button>
                </div>
                <div class="item">
                    <button id="button-9" data-category-id="9">
                        <img src="./img/icons/musica.png">
                        <p>Música</p>
                    </button>
                </div>
                <div class="item">
                    <button id="button-10" data-category-id="10">
                        <img src="./img/icons/tecnologia.png">
                        <p>Tecnología</p>
                    </button>
                </div>
            </div>
            <div class="container products-container">
                <div class="filter">
                    <h2>Filtros</h2>
                    <div class="item_filter">
                        <button class="filter_button" id="filter_button_brands">
                            <h3>Marca</h3>
                        </button>
                        <ul class="filter_list" id="filter_list_brands">
                            <!-- Aquí irán las marcas -->
                        </ul>
                    </div>
                    <div class="item_filter">
                        <button class="filter_button" id="filter_button_prices">
                            <h3>Rango de Precios</h3>
                        </button>
                        <div class="filter_list" id="filter_list_prices">
                            <div class="price_filter">
                                <label for="min-price">Min:</label>
                                <input type="number" id="min-price" placeholder="0" />
                                <label for="max-price">Max:</label>
                                <input type="number" id="max-price" placeholder="1000" />
                            </div>
                        </div>
                    </div>
                    <!-- Botón para aplicar los filtros -->
                    <button class="apply-filters-button">Aplicar Filtros</button>
                </div>
                <div class="products">
                    <div class="order-by">
                        <select name="order-by" id="order-by">
                            <option value="">Ordenar Por...</option>
                            <option value="az">A-Z</option>
                            <option value="price_desc">De mayor a menor</option>
                            <option value="price_asc">De menor a mayor</option>
                        </select>
                    </div>
                    <div class="container-articles">
                        <div class="articles">
                        </div>
                        <div class="pagination">
                            <a>1</a>
                            <a>2</a>
                            <a>3</a>
                            <a>></a>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    <footer>
        <div class="about">
            <h5>Sobre UniqMarket</h5>
            <a>Contacto</a>
        </div>
        <div class="logofooter">
            <a href="./index.html"><img src="./img/logo.png" alt="logo" id="logo"></a>
            <p>©2024 UniqMarket</p>
            <p>Creado por Agustin Moreira y el team</p>
        </div>
        <div class="socials">
            <a href="/"><img src="img/icons/instagram.svg" class="icon"></a>
            <a href="/"><img src="img/icons/facebook.svg" class="icon"></a>
            <a href="/"><img src="img/icons/youtube.svg" class="icon"></a>
            <a href="/"><img src="img/icons/tik-tok.svg" class="icon"></a>
        </div>
    </footer>
</body>
<script src="/js/client.js"></script>
<script>
    window.addEventListener('storage', updateUserName);

window.onload = function() {
    updateUserName();
    const userName = localStorage.getItem('user');
    const token = localStorage.getItem('token');
    const userButton = document.getElementById('user-button');
    const registerButton = document.getElementById('register-button');
    const loginButtons = document.querySelector('.login-buttons');
    
    if (token) {
        userButton.textContent = `Bienvenido, ${userName}`;
        userButton.addEventListener('click', toggleDropdownUser); // Mostrar el menú desplegable
        
        registerButton.style.display = 'none';

        // Crear el botón de cerrar sesión y agregarlo al lado del mensaje de bienvenida
        const logoutButton = document.createElement('button');
        logoutButton.textContent = 'Cerrar sesión';
        logoutButton.addEventListener('click', logout);
        logoutButton.classList.add('logout-button');
        document.querySelector('.user-info').appendChild(logoutButton);

        // Añadir clase para mostrar ambos botones juntos
        loginButtons.classList.add('user-logged-in');
    } else {
        userButton.textContent = 'Iniciar Sesión';
        userButton.setAttribute('href', 'login.html');
        registerButton.textContent = 'Registrarse';
    }
};

function toggleDropdown() {
    const dropdown = document.querySelector('.dropdown-menu');
    dropdown.classList.toggle('show');
}

function toggleDropdownUser() {
const dropdown = document.getElementById('user-dropdown');
dropdown.classList.toggle('show');
}

function toggleMenu() {
    const menuDropdown = document.getElementById('menu-dropdown');
    menuDropdown.classList.toggle('show');
}

function updateUserName() {
const userName = localStorage.getItem('user');
const userButton = document.getElementById('user-button');
if (userName) {
    userButton.textContent = `Bienvenido, ${userName}`;
} else {
    userButton.textContent = 'Iniciar Sesión';
}
}

function logout() {
    localStorage.removeItem('token');
    localStorage.removeItem('user');
    window.location.href = '/index.html';
}

document.getElementById('delete-user').addEventListener('click', async () => {
const token = localStorage.getItem('token');
if (!token) {
    alert('No has iniciado sesión.');
    return;
}

const confirmation = confirm('¿Estás seguro de que deseas eliminar tu cuenta? Esta acción es irreversible.');
if (!confirmation) return;

try {
    // Llamada al backend para eliminar el usuario
    const response = await fetch('/api/auth/delete', {
        method: 'DELETE',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
        }
    });

    const result = await response.json();

    if (!response.ok) {
        alert(result.message || 'Error al eliminar la cuenta.');
        return;
    }

    // Eliminar datos de localStorage y redirigir
    localStorage.removeItem('token');
    localStorage.removeItem('user');
    alert('Cuenta eliminada correctamente.');
    window.location.href = '/index.html';
} catch (error) {
    console.error('Error al eliminar la cuenta:', error);
    alert('Hubo un problema al intentar eliminar tu cuenta. Por favor, intenta de nuevo.');
}
});

document.getElementById('edit-user').addEventListener('click', () => {
window.location.href = 'edit-user.html';
});

</script>



</html>